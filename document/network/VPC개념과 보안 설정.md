이번 장에서는 클라우드 서비스를 이용하면서 보안과 관련해서 몇 가지 용어들이 등장 하는데, 이번 기회에 알아보고자 한다.

---

### VPC(Virtual Private Cloud)

- 퍼블릭 클라우드 상에서 제공되는 고객 전용 사설 네트워크로, **각각의 VPC는 논리적으로 완벽하게 분리되어 있어 다른 사용자의 네트워크와 상호 간섭이 발생하는 영역없이 사용 가능하다.** 예를 들어 아파트라는 네트워크 안에서 각각의 집을 VPC로 보면 된다.
- VPC의 IP 범위를 RFC1918에 명시된 사설 IP 주소 대역을 사용하여 구축해야한다. 사설 IP란 인터넷을 위해 사용하는 것이 아닌 Private하게 사용하는 아이피 주소를 말한다. 더 쉽게 이해해보면 옆집도 안방이 있고 우리집도 안방이 있다. 이 ‘안방’이라는 개념이 RFC1918에서 정의한 대역이라고 보면 된다.
    - 10.0.0.0/8 (10.0.0.0~10.255.255.255) 내에서 /16~/28 범위
    - 172.16.0.0/12 (172.16.0.0~172.31.255.255) 내에서 /16~/28 범위
    - 192.168.0.0/16 (192.168.0.0~192.179.255.255) 내에서 /16~/28 범위
- VPC가 만들어 진 후 서브넷을 이용하여 VPC 내 네트워크 공간을 세분화 하여 사용이 가능하다. 뒤에서 설명하겠지만 서브넷은 VPC안에 있는 VPC보다 더 작은 단위이며, 각각의 서브넷은 가용영역안에 존재하며 서브넷안에 RDS, EC2와같은 리소스들을 위치시킬 수 있다.
- NACL을 이용하여 inbound/outbound 네트워크 트래픽을 Subnet 단위로 제어 가능하다.
- 한번 설정된 아이피대역은 수정할 수 없다.

---

### 서브넷(Subnet)

![스크린샷 2024-04-11 오후 10.18.13.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/c4208ea1-f20c-48bd-b05a-8f485cb16b9b/91c7d210-5706-45e5-8385-22b020acc079/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-04-11_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.18.13.png)

- VPC 네트워크 대역 공간을 세분화하여 사용한다.
- **인터넷 게이트웨이, NAT 게이트웨이용 서브넷을 별도로 생성하여 외부 인터넷과의 통신을 조절할 수 있다.**
    - **Public Subnet**
        - **VPC는 외부 서비스와의 통신이 기본적으로 안되는데 → 사설 IP 주소 대역을 사용하기 때문에, Public Subnet은 Internet gateway를 통해서 외부와의 통신이 가능하다.**

          ![스크린샷 2024-04-11 오후 10.29.27.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/c4208ea1-f20c-48bd-b05a-8f485cb16b9b/11e6883c-1f9e-491b-9325-c8da11537ffb/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-04-11_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.29.27.png)

    - **Private Subnet**
        - 기본적으로 외부와 차단되어 있다.
    - **인터넷 게이트웨이**
        - **인터넷 게이트웨이는 수평 확장되고 가용성이 높은 중복 VPC 구성 요소**로, VPC와 인터넷 간에 통신할 수 있게 해준다.
- NACL을 이용하여 inbound/outbound 네트워크 트래픽을 Subnet 단위로 제어가 가능하다.
    - **NACL**
        - Network Access Control List의 약자로 **VPC의 보안을 강화시키는 요소이다.**
        - 하나의 서브넷은 하나의 NACL만 연동 가능, 단 하나의 NACL은 여러 서브넷에 연동 가능하다.(1:N)

  | ACG (Access Control Group) | NACL (Network ACL) |
      | --- | --- |
  | 서버 NIC 단위로 적용 | Subnet 단위로 적용 |
  | Allow 규칙에 한하여 지원 | Allow, Deny 규칙 모두 지원 |
  | Stateful: Response 트래픽 자동 허용 | Stateless: Response 트래픽에 대한 Allow 규칙이 추가적으로 필요, 들어오는 트래픽과 나가는 트래픽을 구분하지 않는다. 들어오는 트래픽과 나가는 트래픽을 구분하지 않음, 즉 일반적으로 Outbound에 임시 포트 범위를 열어 주어야 정상적으로 통신 가능하다. |
  | 모든 규칙을 확인하여 판단 | 우선순위에 따라 규칙을 반영 |

쉽게 말해, 아래 사진을 보면 된다.

![스크린샷 2024-04-11 오후 10.31.19.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/c4208ea1-f20c-48bd-b05a-8f485cb16b9b/e9d4a8dd-ac6e-4840-867f-aefb6e139d60/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-04-11_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.31.19.png)