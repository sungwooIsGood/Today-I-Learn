- 리눅스 환경

MariaDB 로그 파일은 일반적으로 **`/var/log/mysql`** 또는 **`/var/log/mariadb`** 디렉토리에 있다. 이 디렉토리에는 MariaDB 로그 파일이 포함된 여러 파일이 있을 수 있다.

기본적으로 MariaDB는 다음과 같은 로그 파일을 생성한다.

- **`error.log`**: MariaDB에서 발생한 오류에 대한 정보를 기
- **`query.log`**: 모든 쿼리에 대한 정보를 기
- **`slow_query.log`**: 실행 시간이 긴 쿼리에 대한 정보를 기
- **`binlog`**: 바이너리 로그 파일로, 데이터베이스 변경 사항을 기록

로그 파일 이름은 보통 **`mysqld.log`**, **`mariadb.log`** 또는 **`error.log`**와 같이 정해져 있다. 따라서 **`/var/log/mysql`** 또는 **`/var/log/mariadb`** 디렉토리에서 이러한 파일을 찾아볼 수 있다.

### 그렇다면 마리아DB에 로그를 쌓으면 어떤 장단점이 있을까?

- **장점**
    - **문제 진단:** 로그는 시스템에 발생한 문제를 진단하는 데 유용하다. 예를 들어, 데이터베이스가 다운되거나 오류가 발생할 때 로그를 확인하면 오류가 발생한 시점에서 무엇이 잘못되었는지 파악할 수 있다.
    - **성능 향상:** 느린 쿼리 로그를 기록하면 성능 저하를 일으키는 쿼리를 식별하여 최적화할 수 있습니다.
    - **보안 강화:** 보안 로그를 기록하면 시스템에 악성 코드가 침투했을 때, 공격자가 수행한 활동을 추적하고 보안을 강화할 수 있다.
    - **데이터 분석:** 로그를 기록하면 데이터를 분석하여 시스템의 사용 패턴 및 행동을 이해할 수 있다. 이를 통해 리소스 사용량, 사용자 활동 등을 파악하고 개선할 수 있다.

MariaDB에서 로그를 적극적으로 쌓는 것은 디버깅 및 모니터링 등의 목적으로 매우 유용하다. 그러나 로그가 너무 많으면 디스크 공간을 소모하고 성능 문제를 일으킬 수 있다.

- **단점**
    - 로그가 많이 쌓이면 디스크 공간이 부족해질 가능성이 높다. 특히, 바이너리 로그 파일의 경우 매우 큰 파일을 생성할 수 있으며, 이는 디스크 공간을 많이 차지할 수 있다. 또한, 로그 파일이 디스크에 쓰이는 동안 I/O 작업이 증가하여 시스템 성능에 영향을 미칠 수 있다.
    - 로그 파일이 많아지면 로그 파일을 관리하기가 어려워질 수 있다. 예를 들어, 로그 파일이 매우 커서 읽기 및 분석하기가 어렵거나, 오래된 로그 파일을 삭제하기가 어려울 수 있다.
    - 따라서, 로그를 적극적으로 쌓는 경우, 로그를 주기적으로 백업하고, 디스크 공간을 모니터링하고, 오래된 로그 파일을 정기적으로 삭제하는 것이 좋다. 또한, 로그를 적극적으로 쌓는 경우에는 디스크 I/O 작업에 대한 부하를 고려하여 시스템 성능을 모니터링 해야 한다.


즉, 로그를 너무 오래 쌓아두면 관리가 힘들고 I/O 작업 시 부하가 생겨 시스템 성능이 감소할 수 있다. 그렇기 때문에 주기적으로 지워주어야 한다.

### 로그를 주기적으로 지워주는 방법

MariaDB에서 로그를 삭제하는 방법은 여러 가지가 있습니다. 여기에는 가장 일반적인 방법 몇 가지있다.

1. **로그 파일 자동 삭제 설정**
    1. MariaDB에서는 일정 기간이 지난 로그 파일을 자동으로 삭제할 수 있도록 설정할 수 있다. 이를 위해서는 **`expire_logs_days`** 시스템 변수를 설정하면 된다. **이 변수는 로그 파일이 생성된 후 일정 기간이 지나면 해당 로그 파일을 삭제한다.** 예를 들어, **`expire_logs_days=7`**을 설정하면 7일 이상 된 로그 파일은 자동으로 삭제된다.

**`expire_logs_days`** 변수는 **`my.cnf`** 파일에 설정할 수 있습니다. 다음과 같이 설정한다.

```
[mysqld]
expire_logs_days = 7
```

설정 후 MariaDB 서비스를 재시작하면 새 설정이 적용된다.

1. **로그 파일 수동 삭제**

로그 파일을 수동으로 삭제하는 방법도 있다. 이를 위해서는 **`/var/log/mysql`** 또는 **`/var/log/mariadb`** 디렉토리에서 삭제하려는 로그 파일을 찾아서 직접 삭제하면 된다. 예를 들어, **`query.log`** 파일을 삭제하려면 다음과 같이 명령을 실행하면 된다.

```
sudo rm /var/log/mysql/query.log
```

1. **로그 파일 크기 제한 설정**

MariaDB에서는 로그 파일의 크기를 제한하여 로그 파일이 너무 커지지 않도록 설정할 수 있다. **`max_binlog_size`** 또는 **`max_binlog_files`** 시스템 변수를 설정한다. **`max_binlog_size`**는 바이너리 로그 파일의 최대 크기를, **`max_binlog_files`**는 저장할 수 있는 바이너리 로그 파일의 최대 개수를 말한다.

예를 들어, **`max_binlog_size=100M`**을 설정하면 바이너리 로그 파일의 크기가 100MB를 초과하면 새로운 로그 파일이 생성된다. **`max_binlog_files=10`**을 설정하면 10개의 바이너리 로그 파일까지만 저장된다.

이러한 변수는 **`my.cnf`** 파일에 설정할 수 있다.

```
[mysqld]
max_binlog_size = 100M
max_binlog_files = 10
```

설정 후 MariaDB 서비스를 재시작하면 새 설정이 적용된다.

### 어떠한 로그를 쌓는걸까?

1. **일반 쿼리 로그 (General Query Log)**
    - 모든 쿼리를 기록하는 로그
    - **`general_log`** 시스템 변수를 사용하여 활성화하거나 비활성화 할 수 있다.
2. **오류 로그 (Error Log)**
    - MariaDB에서 발생한 모든 오류를 기록하는 로그
    - **`log_error`** 시스템 변수를 사용하여 로그 파일의 경로를 설정할 수 있다.
3. **슬로우 쿼리 로그 (Slow Query Log)**
    - 실행 시간이 오래 걸리는 쿼리를 기록하는 로그
    - **`slow_query_log`** 시스템 변수를 사용하여 활성화하거나 비활성화할 수 있다.
    - **`long_query_time`** 시스템 변수를 사용하여 실행 시간이 얼마 이상인 쿼리를 슬로우 쿼리로 기록할 것인지 설정할 수 다.
4. **바이너리 로그 (Binary Log)**
    - 데이터 변경 작업을 기록하는 로그
    - **`log_bin`** 시스템 변수를 사용하여 활성화하거나 비활성화 할 수 있다.
5. **재실행 로그 (Redo Log)**
    - 데이터베이스 변경 작업을 임시로 기록하는 로그
    - **`innodb_log_file_size`**와 **`innodb_log_files_in_group`** 시스템 변수를 사용하여 로그 파일의 크기와 개수를 설정할 수 있다.
6. **회복 로그 (Undo Log)**
    - 데이터 변경 작업을 롤백 할 때 사용하는 로그
    - **`innodb_undo_directory`** 시스템 변수를 사용하여 로그 파일의 저장 경로를 설정할 수 있다.

위와 같은 로그들은 MariaDB의 안정적인 운영과 유지보수에 매우 중요하다. 적절한 로그 설정과 관리를 통해 문제 발생 시 원인 파악과 해결을 빠르게 할 수 있다.

또한, **`general_log`** 시스템 변수는 일반 쿼리 로그를 활성화하고 비활성화 할 때 사용되는 변수다. **`general_log`**변수를 **`ON`**으로 설정하면 일반 쿼리 로그가 활성화되어 모든 쿼리가 로그에 기록된다. 다른 로그들에는 영향을 주지 않는다. 즉, **`general_log`**를 **`ON`**으로 설정해도 다른 로그들은 여전히 기본 설정대로 동작하며, 별도의 설정 변경이 필요하지 않다.