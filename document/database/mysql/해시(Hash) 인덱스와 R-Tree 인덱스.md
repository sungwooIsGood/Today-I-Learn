### 해시(Hash) 인덱스

일단 들어가기 앞서 해시 인덱스는 B-Tree만큼 범용적이지 않지만 고유의 특성과 용도를 지닌 인덱스 가운데 중 하나이다. **해시 인덱스는 특히 동등 비교 검색에는 최적화 되어 있다. 하지만 범위를 검색한다거나 정렬된 결과를 가져오는 목적으로는 사용할 수 없다는 것을 알 필요가 있다.**

**해시 인덱스는 메모리 기반의 테이블에 주로 구현(key-value)되어 있으며, 디스크 기반의 대용량 테이블용으로는 거의 사용 되지 않는다는 특징이 있다.** 해시 인덱스 알고리즘은 테이블의 인덱스 뿐 아니라 InnoDB의 버퍼 풀에서 빠른 레코드 검색을 위한 어댑티브 해시 인덱스(Adaptive Hash Index)로 사용되기도 하고, 또, 오라클과 같은 DBMS에서는 JOIN에 사용되기도 한다.

다시한번 언급하지만 **해시 인덱스는 주로 메모리 기반의 테이블에서 주로 사용**되지만 기본적인 특성은 반드시 알아두자.


- **구조 및 특성**

  ![스크린샷 2024-03-10 오후 1.31.55.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/c4208ea1-f20c-48bd-b05a-8f485cb16b9b/7682c5da-4e45-42f9-880d-21f0ef250138/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-10_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.31.55.png)

  위 이미지에서 괄호 안의 값은 해시 함수가 실행되기 이전의 원본 값임.


  **해시 인덱스의 큰 장점은 실제 키값과는 관계없이 인덱스 크기가 작고 검색이 빠르다는 것이다. 위의 그림에서 보는 것 처럼 해시 인덱스는 트리 형태의 구조가 아니므로 검색하고자 하는 값을 주면 해시 함수를 거쳐 찾고자 하는 키 값이 포함된 버킷을 찾는다. 그리고 버킷 하나만 읽어서 비교해 보면 실제 레코드가 저장된 위치를 바로 알 수 있다.**


  **그렇기 때문에 여러 노드를 내려가면서 읽는 B-Tree보다 상당히 빠른 결과를 반환 한다.**

  해시 인덱스는 원래 키값을 저장하는 것이 아니라 해시 함수의 결과(일반적으로 단순 숫자값)만을 저장하므로 키 값의 값이 아무리 길어도 실제 해시 인덱스에 저장되는 값은 4~8바이트 수준으로 상당히 줄어든다.

  **해시 인덱스에서 가장 중요한 것은 해시 함수로, 입력된 키 값이 어디에 저장될지를 결정하는 함수다.**

  해시 함수의 결과 값의 범위가 넓으면 그만큼 버킷에 많이 필요해져서 공간의 낭비가 커지고, 값의 범위가 너무 작으면 충돌되는 경우가 많이 발생해 해시 인덱스의 장점이 사라진다. → 충돌, 해시 함수의 결과 값이 같은 경우

  간단하게 알아보자.

    ```sql
    해시 함수 F(value) = CRC32(value) % 10
    
    F('Banette') = 7
    F('Aamer') = 9
    F('Jaana') = 9
    ```

  CRC16이라는 함수의 결과 값을 10으로 나눈 결과 나머지 값을 취하는 것으로 해시 함수를 정의한 것이다. 위에서 `Jaana` , `Aamer` 의 값이 9라는 것을 볼 수 있는데 이를 충돌이라고 표현한다. **해시 함수 결과 값의 범위가 좁으면 필요한 버킷의 개수가 적어지지만 충돌이 많고, 반대로 해시 함수 결과 값의 범위가 넓으면 버킷의 개수가 많이 필요해져 충돌이 줄어든다. 충돌이 많다는 것은 검색 효율이 떨어지는 것이다.**

  > 해시 알고리즘은 여러가지 목적으로 사용될 수 있지만 DBMS에서는 주로 인덱스와 테이블의 파티셔닝 용도로 사용된다. 
  >  
  > 검색을 위해 해시 알고리즘이 사용되는 경우에는 해시 함수의 결과 값이 범위가 넓어야 충돌이 줄어들고 그만큼 검색 성능이 높아진다. 
  > 
  > 하지만 테이블의 파티셔닝 용도로 사용되는 경우에는 해시 함수가 필요한 파티션의 개수 만큼만 만들어 내도록 설계해야 하므로 해시 함수의 결과 값의 범위를 좁게 사용한다. 그렇기 때문에 MySQL의 해시 파티션은 이러한 알고리즘으로 파티셔닝하는 기능을 한다.

